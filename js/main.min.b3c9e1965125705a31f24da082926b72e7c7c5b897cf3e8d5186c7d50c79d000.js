const Yagu=(()=>{const t=e=>{const s=document.getElementById("site-nav"),n=document.getElementById("nav-mask"),t=s.classList.toggle("open");e.setAttribute("aria-expanded",t?"true":"false"),n&&n.classList.toggle("show",t),document.body.style.overflow=t?"hidden":""},e=()=>{const t=document.getElementById("reading-progress");if(!t)return;const e=document.documentElement,n=e.scrollTop/(e.scrollHeight-e.clientHeight);t.style.width=`${Math.max(0,Math.min(1,n))*100}%`},n=e=>{const t=parseInt(e.dataset.n||"0",10)+1;e.dataset.n=t,e.textContent=`赞 · ${t}`},s=()=>{document.querySelectorAll(".carousel").forEach(e=>{let t=0;const n=e.querySelectorAll(".slide"),s=e=>{n.forEach((t,n)=>{t.style.display=n===e?"block":"none"})};s(0);let i=null;const a=e.dataset.auto==="true";a&&n.length>1&&(i=setInterval(()=>{t=(t+1)%n.length,s(t)},4e3));let o=0;e.addEventListener("touchstart",e=>{o=e.touches[0].clientX}),e.addEventListener("touchend",e=>{const i=e.changedTouches[0].clientX-o;(i<0?-i:i)>30&&(t=i<0?(t+1)%n.length:(t-1+n.length)%n.length,s(t))})})},o=()=>{document.addEventListener("scroll",e,{passive:!0}),e(),s(),document.addEventListener("click",e=>{const t=document.getElementById("site-nav"),n=document.querySelector(".hamburger"),s=document.getElementById("nav-mask");if(!t||!n)return;const i=t.classList.contains("open");if(!i)return;const o=e.target;if(t.contains(o)||n.contains(o))return;t.classList.remove("open"),n.setAttribute("aria-expanded","false"),s&&s.classList.remove("show"),document.body.style.overflow=""});let n=[],t=0;const o=()=>{let e=document.getElementById("lightbox");if(!e){e=document.createElement("div"),e.id="lightbox",e.className="lightbox";const s=document.createElement("button");s.className="lb-prev",s.setAttribute("aria-label","上一张"),s.textContent="‹";const i=document.createElement("img"),o=document.createElement("button");o.className="lb-next",o.setAttribute("aria-label","下一张"),o.textContent="›",e.appendChild(s),e.appendChild(i),e.appendChild(o),document.body.appendChild(e),s.addEventListener("click",e=>{e.stopPropagation(),t=(t-1+n.length)%n.length,i.src=n[t]}),o.addEventListener("click",e=>{e.stopPropagation(),t=(t+1)%n.length,i.src=n[t]}),e.addEventListener("click",()=>{e.classList.remove("open"),document.body.style.overflow=""})}return e};document.addEventListener("click",e=>{const s=e.target;if(!(s instanceof Element))return;const i=!!document.querySelector("section.shuoshuo"),r=!!document.querySelector("article.post"),a=!!document.querySelector("article.photo-article"),c=i||r||a;if(c&&s.matches("img")){const r=s.closest("a"),l=!!(r&&(r.classList.contains("row-card")||r.classList.contains("card")||r.classList.contains("friend")));r&&!l&&e.preventDefault();const c=o(),d=c.querySelector("img"),u=i?document.querySelector("section.shuoshuo")||document:a?document.querySelector("article.photo-article")||document:document.querySelector("article.post .post-content")||document,h=u.querySelectorAll("img");n=Array.from(h).filter(e=>{const t=e.closest("a"),n=!!(t&&(t.classList.contains("row-card")||t.classList.contains("card")||t.classList.contains("friend")));return!n}).map(e=>e.getAttribute("src")),t=Math.max(0,n.indexOf(s.getAttribute("src"))),d.src=n[t]||s.getAttribute("src"),c.classList.add("open"),document.body.style.overflow="hidden"}else{const e=document.getElementById("lightbox");e&&e.classList.contains("open")&&!e.querySelector("img").contains(s)&&!e.querySelector(".lb-prev").contains(s)&&!e.querySelector(".lb-next").contains(s)&&(e.classList.remove("open"),document.body.style.overflow="")}}),document.addEventListener("keydown",e=>{const s=document.getElementById("lightbox");if(e.key==="Escape")s&&(s.classList.remove("open"),document.body.style.overflow="");else if(s&&s.classList.contains("open"))if(e.key==="ArrowLeft"){const e=s.querySelector("img");t=(t-1+n.length)%n.length,e.src=n[t]}else if(e.key==="ArrowRight"){const e=s.querySelector("img");t=(t+1)%n.length,e.src=n[t]}})};return{toggleNav:t,like:n,init:o}})();document.addEventListener("DOMContentLoaded",Yagu.init)