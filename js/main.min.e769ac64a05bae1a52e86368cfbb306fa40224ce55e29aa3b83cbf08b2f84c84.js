const Yagu=(()=>{const t=e=>{const s=document.getElementById("site-nav"),n=document.getElementById("nav-mask"),t=s.classList.toggle("open");e.setAttribute("aria-expanded",t?"true":"false"),n&&n.classList.toggle("show",t),document.body.style.overflow=t?"hidden":""},e=()=>{const t=document.getElementById("reading-progress");if(!t)return;const e=document.documentElement,n=e.scrollTop/(e.scrollHeight-e.clientHeight);t.style.width=`${Math.max(0,Math.min(1,n))*100}%`},n=e=>{const t=parseInt(e.dataset.n||"0",10)+1;e.dataset.n=t,e.textContent=`赞 · ${t}`},s=()=>{document.querySelectorAll(".carousel").forEach(e=>{let t=0;const n=e.querySelectorAll(".slide"),s=e=>{n.forEach((t,n)=>{t.style.display=n===e?"block":"none"})};s(0);let i=null;const a=e.dataset.auto==="true";a&&n.length>1&&(i=setInterval(()=>{t=(t+1)%n.length,s(t)},4e3));let o=0;e.addEventListener("touchstart",e=>{o=e.touches[0].clientX}),e.addEventListener("touchend",e=>{const i=e.changedTouches[0].clientX-o;(i<0?-i:i)>30&&(t=i<0?(t+1)%n.length:(t-1+n.length)%n.length,s(t))})})},o=()=>{document.addEventListener("scroll",e,{passive:!0}),e(),s(),document.addEventListener("click",e=>{const t=document.getElementById("site-nav"),n=document.querySelector(".hamburger"),s=document.getElementById("nav-mask");if(!t||!n)return;const i=t.classList.contains("open");if(!i)return;const o=e.target;if(t.contains(o)||n.contains(o))return;t.classList.remove("open"),n.setAttribute("aria-expanded","false"),s&&s.classList.remove("show"),document.body.style.overflow=""});let t=[],n=0;const o=()=>{let e=document.getElementById("lightbox");if(!e){e=document.createElement("div"),e.id="lightbox",e.className="lightbox";const s=document.createElement("button");s.className="lb-prev",s.setAttribute("aria-label","上一张"),s.textContent="‹";const a=document.createElement("img"),o=document.createElement("button");o.className="lb-next",o.setAttribute("aria-label","下一张"),o.textContent="›";const i=document.createElement("button");i.className="lb-close",i.setAttribute("aria-label","关闭"),i.textContent="×";const r=document.createElement("div");r.className="lb-count",e.appendChild(s),e.appendChild(a),e.appendChild(o),e.appendChild(i),e.appendChild(r),document.body.appendChild(e);const c=()=>{r.textContent=`${t.length?n+1:1} / ${t.length||1}`},l=e=>{if(!t.length)return;const n=new Image;n.src=t[(e+1)%t.length];const s=new Image;s.src=t[(e-1+t.length)%t.length]};s.addEventListener("click",e=>{e.stopPropagation(),n=(n-1+t.length)%t.length,a.src=t[n],c(),l(n)}),o.addEventListener("click",e=>{e.stopPropagation(),n=(n+1)%t.length,a.src=t[n],c(),l(n)}),i.addEventListener("click",t=>{t.stopPropagation(),e.classList.remove("open"),document.body.style.overflow=""}),e.addEventListener("click",()=>{e.classList.remove("open"),document.body.style.overflow=""});let d=0;e.addEventListener("touchstart",e=>{d=e.touches[0].clientX},{passive:!0}),e.addEventListener("touchend",e=>{const s=e.changedTouches[0].clientX-d;(s<0?-s:s)>30&&t.length&&(n=s<0?(n+1)%t.length:(n-1+t.length)%t.length,a.src=t[n],c(),l(n))})}return e};document.addEventListener("click",e=>{const s=e.target;if(!(s instanceof Element))return;const i=!!document.querySelector("section.shuoshuo"),r=!!document.querySelector("article.post"),a=!!document.querySelector("article.photo-article"),c=i||r||a;if(c&&s.matches("img")){const r=s.closest("a"),d=!!(r&&(r.classList.contains("row-card")||r.classList.contains("card")||r.classList.contains("friend")));r&&!d&&e.preventDefault();const c=o(),u=c.querySelector("img"),l=c.querySelector(".lb-count"),h=i?document.querySelector("section.shuoshuo")||document:a?document.querySelector("article.photo-article")||document:document.querySelector("article.post .post-content")||document,m=h.querySelectorAll("img");t=Array.from(m).filter(e=>{const t=e.closest("a"),n=!!(t&&(t.classList.contains("row-card")||t.classList.contains("card")||t.classList.contains("friend")));return!n}).map(e=>e.getAttribute("src")),n=Math.max(0,t.indexOf(s.getAttribute("src"))),u.src=t[n]||s.getAttribute("src"),l&&(l.textContent=`${t.length?n+1:1} / ${t.length||1}`),c.classList.add("open"),document.body.style.overflow="hidden"}else{const e=document.getElementById("lightbox");e&&e.classList.contains("open")&&!e.querySelector("img").contains(s)&&!e.querySelector(".lb-prev").contains(s)&&!e.querySelector(".lb-next").contains(s)&&!(e.querySelector(".lb-close")&&e.querySelector(".lb-close").contains(s))&&!(e.querySelector(".lb-count")&&e.querySelector(".lb-count").contains(s))&&(e.classList.remove("open"),document.body.style.overflow="")}}),document.addEventListener("keydown",e=>{const s=document.getElementById("lightbox");if(e.key==="Escape")s&&(s.classList.remove("open"),document.body.style.overflow="");else if(s&&s.classList.contains("open"))if(e.key==="ArrowLeft"){const o=s.querySelector("img");n=(n-1+t.length)%t.length,o.src=t[n];const e=s.querySelector(".lb-count");e&&(e.textContent=`${n+1} / ${t.length}`)}else if(e.key==="ArrowRight"){const o=s.querySelector("img");n=(n+1)%t.length,o.src=t[n];const e=s.querySelector(".lb-count");e&&(e.textContent=`${n+1} / ${t.length}`)}})};return{toggleNav:t,like:n,init:o}})();document.addEventListener("DOMContentLoaded",Yagu.init)